<!DOCTYPE html>
<html>
<head>
  <title>Tracker - LeapMotion</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">
  <style>
  body {
    background-color: #000000;
    margin: 0px;
  }
  canvas {
    background-color:#222;
    display:block; 
    position:absolute; 
  }
  .container {
    width:auto;
    text-align:center;
  }
  /* additional Pointer events behavior */

  canvas {
      touch-action: none;
  }
  </style>

  <!-- LeapMotion API -->
  <script src="../leap.min.js"></script>

</head>
<body>

<script>
var canvas,
  c, // c is the canvas' context 2D
  container,
  ratio;

var points = [];

function loop() {
  /* hack to work around lack of orientationchange/resize event */
  if(canvas.height != window.innerHeight * ratio) {
    canvas.width = window.innerWidth * ratio;
    canvas.height = window.innerHeight * ratio;
  } else {
    c.clearRect(0,0,canvas.width, canvas.height);
  }

  for (var i = 0; i<points.length; i++) {
    /* work out extra LeapMotion values */
    var radius = 50*(1-(Math.abs(points[i].distance)));
    c.lineWidth = 10*(1-(Math.abs(points[i].distance)));
    /* draw all circles */
    c.beginPath();
    c.arc(points[i].clientX, points[i].clientY, radius, 0, Math.PI*2, true);
    c.stroke();
  }
}

function init() {
  canvas = document.createElement( 'canvas' );
  c = canvas.getContext( '2d' );
  container = document.createElement( 'div' );
  container.className = "container";
  // HiDPI canvas http://www.html5rocks.com/en/tutorials/canvas/hidpi/
  devicePixelRatio = window.devicePixelRatio || 1,
  backingStoreRatio = c.webkitBackingStorePixelRatio ||
                      c.mozBackingStorePixelRatio ||
                      c.msBackingStorePixelRatio ||
                      c.oBackingStorePixelRatio ||
                      c.backingStorePixelRatio || 1,

  ratio = devicePixelRatio / backingStoreRatio;
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  // upscale the canvas if the two ratios don't match
  if (devicePixelRatio !== backingStoreRatio) {

    var oldWidth = canvas.width;
    var oldHeight = canvas.height;

    canvas.width = oldWidth * ratio;
    canvas.height = oldHeight * ratio;

    canvas.style.width = oldWidth + 'px';
    canvas.style.height = oldHeight + 'px';
    // now scale the context to counter
    // the fact that we've manually scaled
    // our canvas element
    c.scale(ratio, ratio);
  }
  container.appendChild(canvas);
  document.body.appendChild( container );
  c.strokeStyle = "#eee";
  c.lineWidth = "10";

  var controller = new Leap.Controller();

  controller.on('connect', function(){
     setInterval(function(){
        var frame = controller.frame();
        if (frame.pointables.length > 0) {
          // clear existing points
          points = [];
          for (var i = 0; i < frame.pointables.length; i++) {
            var pointable = frame.pointables[i];
            var interactionBox = frame.interactionBox;
            var pos = interactionBox.normalizePoint(pointable.stabilizedTipPosition, true);
            var x = canvas.width * pos[0];
            var y = canvas.height * (1 - pos[1]);
            // construct a "fake" and expanded event object (just so the loop can remain same-ish)
            points[i] = { clientX: x.toFixed(1), clientY: y.toFixed(1), distance: pointable.touchDistance };
          }
        }
        loop();
     }, 1000/60);
  });
  controller.connect();
}

window.addEventListener('load',function() {
  /* hack to prevent firing the init script before the window object's values are populated */
  setTimeout(init,100);
},false);
</script>
</body>
</html>